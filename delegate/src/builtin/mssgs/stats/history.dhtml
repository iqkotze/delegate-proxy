<html>

${auth?:
<body>
<h3>Not Configured</h3>
Your DeleGate must be configured to allow accesses to this history viewer.
Any kind of authentication/authorization will do.  The simplest way is
specifying an AUTHORIZER for the MOUNT point of statistics viewer
with one of the following examples.
<p><pre><font face="courier new">
  <BIG>Example:</BIG>

    MOUNT="/-/stats/* = AUTHORIZER=-none"
        ## allows access without authentication.
        ## combinient for a demonstration server.

    MOUNT="/-/stats/* = AUTHORIZER=-any"
        ## allows access if any username and/or password is given by clients.
        ## combinient to identify client by username and filtering by the identity.

    MOUNT="/-/stats/* = AUTHORIZER=-list{<i>Usernae</i>:<i>Passowrd</i>}"
        ## allows access if the <i>Username</i> with <i>Password</I> is given by clients.
        ## useful to limit access only to the administrator knowing this credential.
</font></pre>
See the <a href=http://www.delegate.org/delegate/Manual.htm>Manual</a>
of DeleGate for more details about
<a href=http://www.delegate.org/delegate/Manual.htm?MOUNT>MOUNT</a> and
<a href=http://www.delegate.org/delegate/Manual.htm?AUTHORIZER>AUTHORIZER</a>.
</body>
${exit}
}

<!-- Default/Common values
${maxima.lines.10,20,10000}
${maxima.psize.1,100,1000}
${maxima.refresh.10,60,3600}
${default.exclude."302,404"}
${def.Excludes.${excludes?, excluding "${formv.excludes}"}}
-->

${formv.pagesize.max?  ${setformv.lines.${max}}  ${setformv.psize.${max}}}
${formv.pagesize.dflt? ${setformv.lines.${dflt}} ${setformv.psize.${dflt}}}
${formv.pagesize.min?  ${setformv.lines.${min}}  ${setformv.psize.${min}}}

<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
${formv.dorefresh?
<meta http-equiv="Refresh" content="${limit.refresh};url=?act=TAIL&${formv.ALL}">
}
</head>

<body>
<title>DG History Viewer</title>

<form action="" method="POST">
<font face="courier new">

${formv.simplehead?
<!-- begin -- the following should be generated by formv.ALL -->
 <input type=hidden name=talt      value=${formv.talt}>
 <input type=hidden name=ago       value=${formv.ago}>
 <input type=hidden name=fromdate  value=${formv.fromdate}>
 <input type=hidden name=fromtime  value=${formv.fromtime}>
 <input type=hidden name=pagesize  value=${formv.pagesize}>
 ${formv.dorefresh?
 <input type=hidden name=dorefresh value=${formv.dorefresh}>
 }
 <input type=hidden name=refresh   value=${formv.refresh}>
 <input type=hidden name=includes  value=${formv.includes}>
 <input type=hidden name=excludes  value=${formv.excludes}>
 <input type=hidden name=URLinc    value=${formv.URLinc}>
 <input type=hidden name=URLexc    value=${formv.URLexc}>
 ${formv.mineonly?
 <input type=hidden name=mineonly  value=${formv.mineonly}>
 }
 ${formv.excludemine?
 <input type=hidden name=excludemine  value=${formv.excludemine}>
 }
 ${formv.simplefmt?
 <input type=hidden name=simplefmt value=${formv.simplefmt}>
 }
 ${formv.hideday?
 <input type=hidden name=hideday   value=${formv.hideday}>
 }
 ${formv.hidehost?
 <input type=hidden name=hidehost  value=${formv.hidehost}>
 }
 ${formv.hidecode?
 <input type=hidden name=hidecode  value=${formv.hidecode}>
 }
 ${formv.guide?
 <input type=hidden name=guide     value=${formv.guide}>
 }
 ${formv.remember?
 <input type=hidden name=remember  value=${formv.remember}>
 }
 <input type=hidden name=inJapanese value=${formv.inJapanese}>
<!-- end -->

 <table border=0 width=800px bgcolor="#f0f0f0">
  <tr>
   <td>
    <a name=top><a href="/-/">DeleGate</a> History Viewer</a>
   </td>
   <td>
    <input type=checkbox name=simplehead ${formv.simplehead?checked}><small>simple</small>
    <input size=5 maxlength=5 type=text name=lines value=${limit.lines}><small>lines</small>
    <input size=5 maxlength=5 type=text name=psize value=${limit.psize}><small>KB</small>

   </td>
  </tr>
 </table>
:
 <a name=top>
 <h3><a href="/-/">DeleGate</a> History Viewer</h2>
 </a>

 <!-- #### formv.ALL begin -->
${formv.ALL.hidden}
 <!-- #### formv.ALL end -->

${formv.guide?
 <table border=0 width=800px bgcolor="#f0f0f0">
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    These text with yellow background show you the guide about how to use this
    control panel. To let these guides dismiss, uncheck the "guide" checkbox
    in "Panel" field bellow and push "Refresh" or ENTER key.
    </font>
   </td>
  </tr>
 </table>
 <p>
}
 <table border=0 width=800px bgcolor="#f0f0f0">
  <tr>
   <td><input type=submit name=act value="Cueing" style="font-size:18px;background-color:#f0f0f0"></td>
   <td>
    <small>

     <font ${formv.talt.ago?:${formv.talt.date?: color=red bgcolor=green}}>
      <input type=radio name=talt value=now ${formv.talt.ago?:${formv.talt.date?:checked}}>
      now
     </font>

     &nbsp;

     <font ${formv.talt.ago? color=red}>
      <input type=radio name=talt value=ago ${formv.talt.ago?checked}>
      <input size=9 type=text name=ago value="${formv.ago?${formv.ago}:00-01-00}" ${formv.talt.ago?style="background-color:#ffe0e0"}>
      d-H-M ago
     </font>

     &nbsp;

     <font ${formv.talt.date? color=red}>
      <input type=radio name=talt value=date ${formv.talt.date?checked}>
      ${formv.talt.ago?
       <input size=9 type=text name=fromdate value=${date.formv.ago}>y-m-d
       <input size=9 type=text name=fromtime value=${time.formv.ago}>H-M-S
      :
       <input size=9 type=text name=fromdate value="${formv.fromdate?${formv.fromdate}:${date.00-01-00}}" ${formv.talt.date?style="background-color:#ffe0e0"}>y-m-d
       <input size=9 type=text name=fromtime value="${formv.fromtime?${formv.fromtime}:${time.00-01-00}}" ${formv.talt.date?style="background-color:#ffe0e0"}>H-M-S
      }
     </font>

    </small>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    "Cueing" sets the starting point of history browsing, selecting a
    history file out of those possibly divided in day-by-day typically.
    Once a history file is selected, TOP, PREV, NEXT, and TAIL in the history
    browser are applied within the selected file.<br><br>
    -- Steps for Cueing --
    <ol>
    <li>select one of three radio buttons (don't forget this step),
    <li>fill the necessary fields,
    <li>push the "Cueing" button or ENTER key.
    </ol>
    -- Meaning of each alternative --
    <ul>
    <li>now -- starting at the last position of the current (latest) history file (default)
    <li>d-H-M ago -- starting at day-Hour-Minutes ago (d[-H[-M]])
    <li>y-m-d and H-M-S -- starting at the specified date-time (y[-m[-d]] [H[-M[-S]]])
    </ul>
    </small>
    </font>
   </td>
  </tr>
}
 </table>
</font>
</form>

<form action="" method="POST">
<font face="courier new">
 <input type=hidden name=talt      value=${formv.talt}>
 <input type=hidden name=ago value=${formv.ago?${formv.ago}:00-01-00}>
 <input type=hidden name=fromdate  value=${formv.fromdate?${formv.fromdate}:${date.00-01-00}}>
 <input type=hidden name=fromtime  value=${formv.fromtime?${formv.fromtime}:${time.00-01-00}}>

 <table border=0 width=800px bgcolor="#f0f0f0">
  <tr>
   <td>Panel</td>
   <td>
    <input type=checkbox name=simplehead ${formv.simplehead?checked}><small>simple</small>
    <input type=checkbox name=guide      ${formv.guide?checked}><small>guide</small>
    <input type=checkbox name=remember   ${formv.remember?checked}><small>remember</small>
    <a href="?act=GETURL&${formv.ALL}"><small>GET URL</small></a>
    <a href="${url.self.full}"><small>restore</small></a>
    <!--
    <input type=checkbox name=inJapanese ${formv.inJapanese?checked}><small>inJapanese</small>
    -->
   </td>
  </tr>
${formv.act.GETURL?
  <tr>
   <td></td>
   <td>
    <textarea wrap=soft cols=70 rows=6>${url.self.full}?${formv.ALL}</textarea>
    <br>
    <input type="submit" value="dismiss">
   </td>
  </tr>
}
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    Check the "remember" checkbox to let your browser remember the setting of
    this control panel in a Cookie, and then let it restore the setting
    afterwards when you revist <a href=${url.self.full}>here</a>
    of which URL is possibly book-marked.
    If you are living without Cookie, click "GET URL" then you will get
    the URL, containing a list of current setting in its query part,
    shown in a text area and browser's URL bar.
    The link "restore" will clean up the dirty URL in the URL bar,
    restoreing the setting from the Cookie if you have.
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>Host</td>
   <td>
    <small>hide[
    <input type=checkbox name=mineonly ${formv.mineonly?checked}>others'
    <input type=checkbox name=excludemine ${formv.excludemine?checked}>mine
    ]</smal>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
     If hide "others'" checkbox is checked, only your own history are shown. 
     If hide "mine" checkbox is checked, only others' history are shown. 
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>Code</td>
   <td>
    <small>include </small>
    <input type=text size=30 name=includes value=${formv.includes?"${formv.includes}":""}>
    <small>exclude </small>
    <input type=text size=30 name=excludes value=${formv.excludes?"${formv.excludes}":"301,404,500"}>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    Specify a comma separated list of HTTP response codes.
    If "include" field is specified, only history records resulted with the code
    are shown.
    If "exclude" field is specified, history record resulted with the code
    are hidden.
    If "include" field is not empty, "exclude" field is ignored.
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>URL</td>
   <td>
    <small>include </small><input type=text size=30 name=URLinc value=${formv.URLinc}>
    <small>exclude </small><input type=text size=30 name=URLexc value=${formv.URLexc}>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    Specify a comma separated list of substring of URL.
    If "include" is specified, only history records containing the string
    in its URL are shown.
    If "exclude" is specified, history records containing the string
    in its URL are hidden.
    Both "include" and "exclude" can be used in combination.
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>Page</td>
   <td>
    <input size=6 maxlength=5 type=text name=lines value=${limit.lines}><small>lines</small>
    <input size=6 maxlength=5 type=text name=psize value=${limit.psize}><small>Kbytes</small>
    <input type=radio name=pagesize value=min><small>min.</small>
    <input type=radio name=pagesize value=dflt><small>default</small>
    <input type=radio name=pagesize value=max><small>max.</small>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    The history is shown page by page of which size is in at most specified
    killo bytes and the number of lines.
    The size is not for the filtered result (filtered by Host, Code and URL) but
    the original history data, 
    If you specified a value out of range, it is automatically rounded.
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>Format</td>
   <td>
    <input type=checkbox name=simplefmt ${formv.simplefmt?checked}><small>simple</small>
    <small>hide[
    <input type=checkbox name=hideday  ${formv.hideday?checked}><small>day</small>
    <input type=checkbox name=hidehost ${formv.hidehost?checked}><small>host</small>
    <input type=checkbox name=hidemethod ${formv.hidemethod?checked}><small>method</small>
    <input type=checkbox name=hidecode ${formv.hidecode?checked}><small>code</small>
    <input type=checkbox name=hidereferer ${formv.hidereferer?checked}><small>referer</small>
    <input type=checkbox name=hideagent ${formv.hideagent?checked}><small>agent</small>
    ]</small>
   </td>
  </tr>
${formv.guide?
  <tr bgcolor=yellow>
   <td></td>
   <td>
    <font face="Times New Roman">
    <small>
    The format of each line shown for a history record.
    The host filed is coded in 4 digits of hex-decimal number to identify a
    client host (in lower 16 bits of CRC32).
    </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td><td></td>
  </tr>
}

  <tr>
   <td>Help</td>
   <td>
    <small>
     <small>
     To apply the filter above, push "Refresh" bellow or ENTER key.
     For more guide, check the "guide" checkbox above and do "Refresh".
     </small>
    &nbsp;<a href=".">up</a>
    </small>
   </td>
  </tr>
 </table>
 <hr size=1 width=800px align=left>
}

<a name="head">
<table width=800px bgcolor="#f0e0f0">
 <tr>
  <td><!-- placed Refresh button first to be default action -->
    <input type=submit name=act value="Refresh" style="font-size:18px;background-color:#f0f0f0">
    <input type=submit name=act value="TOP" style="font-size:18px;background-color:#f0f0f0">
    <input type=submit name=act value="PREV" style="font-size:18px;background-color:#f0f0f0">
    <input type=submit name=act value="NEXT" style="font-size:18px;background-color:#f0f0f0">
    <input type=submit name=act value="TAIL" style="font-size:18px;background-color:#f0f0f0">
 
    <a href="#top"><small>top</small></a>
    <a href="#head"><small>head</small></a>
    <a href="#tail"><small>tail</small></a>
  </td>
 </tr>
</table>
</a>

</font>
${formv.guide?
 <table border=0 width=800px bgcolor="#f0f0f0">
  <tr bgcolor=yellow>
   <td>
    <font face="Times New Roman">
     <small>
      Buttons labeled in uppercase only, TOP, PREV, NEXT, and TAIL will bring you
      to a position within currently selected history file.
      The history file is selected by "Cueing" above.
      <ul>
        <li>"TOP" -- to the beginning of the history file
        <li>"PREV" -- to the previous chunk (or page) in the history file
        <li>"NEXT" -- to the next chunk (or page) in the history file
        <li>"TAIL" -- to the end of the history file
      </ul>
      "Refresh" button does not change the position but refresh the current page
      refrecting (changed) settings in the panel (URL filtering for example).
      You can use ENTER key instead of "Refresh" after you made some modification
      in the panel.
      <br>
      Links labeled in lowercase only, "top", "head" and "tail" are used to jump
      within the generated HTML page.
     </small>
    </font>
   </td>
  </tr>
  <tr bgcolor=white>
   <td>&nbsp;</td>
  </tr>
 </table>
}

<small>
<!-- #### HISTORY BEGIN ####################################### -->
<font face="courier new">
${formv.talt.ago?   Cue[ Since ${formv.ago} ago ]
                              ${history.sinceago}
:${formv.talt.date? Cue[ From date ${formv.fromdate} time ${formv.fromtime} ]
                              ${history.fromdate}
                  : Cue[ Last ${lines.formv.lines} lines out of maximum ${psize.formv.psize}KB ]
                              ${history.last}
                              <pre><font face="courier new">${now.%m/%d-%H:%M:%S} ${clientx} ${client}</font></pre>
  }
}
</font>
<!-- #### HISTORY END ######################################### -->
</small>

<font face="courier new">
<table border=0 width=800px bgcolor="#f0e0f0">
<tr><td>
  <input type=submit name=act value="Refresh" style="font-size:18px;background-color:#f0f0f0">
  <input type=submit name=act value="TOP"     style="font-size:18px;background-color:#f0f0f0">
  <input type=submit name=act value="PREV"    style="font-size:18px;background-color:#f0f0f0">
  <input type=submit name=act value="NEXT"    style="font-size:18px;background-color:#f0f0f0">
  <input type=submit name=act value="TAIL"    style="font-size:18px;background-color:#f0f0f0">

  <a name=tail>
  <a href="#top"><small>top</small></a>
  <a href="#head"><small>head</small></a>
  <a href="#tail"><small>tail</small></a>

  <input type=submit name=act value="refresh" onClick="location.reload(true);">
  </a>
</td></tr>
</table>

<table border=0 width=800px>
  <tr>
${formv.talt.ago?:${formv.talt.date?:${history.islatest?
   <td>
    <input type=checkbox name=dorefresh ${formv.dorefresh?checked}>
    <small>refresh every </small><input type=text size=4 maxlength=4 name=refresh value=${limit.refresh}> <small>sec.</small>
   </td>
}}}
   <td align=right>
    <small>
     offset [${history.begin} - ${history.end}]
    </small>
   </td>
  </tr>
</table>

<!--
${history.islatest?:
<table border=0 width=800px>
 <tr bgcolor="pink">
 <td>
  <small>
   <font style="background-color:pink">
    This history file is not the latest one because you are selecting
    "Cueing" not "now".
   </font>
  </small>
 </td>
 </tr>
</table>
}
-->

${message?
<table border=0 width=800px>
 <tr style="background-color:#e0e0f0">
 <td>
  <font color=blue>
   <small>
    ${message}
   </small>
  </font>
 </td>
 </tr>
</table>
}
${message.error?
<table border=0 width=800px>
 <tr style="background-color:pink">
 <td>
  <small>
    ${message.error}
  </small>
 </td>
 </tr>
</table>
}

</font>
<input type=hidden name=time value=${now.%s}>
</form>

<form action="history.dhtml" method=POST>
<table border=0 width=800px bgcolor="#ffffff">
<tr><td aling=left>
 <input type=hidden name=igncode value="301,404,500">
 <input type=hidden name=time value=${now.%s}>
 <input type=submit value="Reset to the Default">
</td></tr>
</table>
</form>

</body>
</html>
